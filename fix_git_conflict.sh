#!/bin/bash

echo "üîß –†–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ Git —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö ML..."

# –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö ML
echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö ML..."
mkdir -p ml_data_backup
cp data/api_metrics.db ml_data_backup/ 2>/dev/null || echo "‚ö†Ô∏è  api_metrics.db –Ω–µ –Ω–∞–π–¥–µ–Ω"
cp data/stock_history.db ml_data_backup/ 2>/dev/null || echo "‚ö†Ô∏è  stock_history.db –Ω–µ –Ω–∞–π–¥–µ–Ω"
cp data/api_health.db ml_data_backup/ 2>/dev/null || echo "‚ö†Ô∏è  api_health.db –Ω–µ –Ω–∞–π–¥–µ–Ω"

echo "‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞ –≤ ml_data_backup/"

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ stash
echo "üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ stash..."
git stash push -u -m "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ML –ø–µ—Ä–µ–¥ pull"

# –í—ã–ø–æ–ª–Ω—è–µ–º pull
echo "‚¨áÔ∏è  –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ git pull..."
git pull

# –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ ML
echo "üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ML..."
git stash pop

echo "‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç —Ä–µ—à–µ–Ω!"
echo "üìÅ –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ ML —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ ml_data_backup/"
echo "üîç –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: git status" 